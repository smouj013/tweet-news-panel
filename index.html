<!-- index.html ‚Äî News ‚Üí Tweet Template Panel (tnp-v4.0.1+) ‚Äî X Clean Dark ‚Äî PRO + REALTIME TICKERS
  ‚úÖ Mantiene 100% compat con tus IDs/clases actuales (NO rompe nada)
  ‚úÖ A√±ade contenedores para:
     - Newsticker en tiempo real (noticias m√°s relevantes)
     - Trend ticker / popticker (hashtags / tendencias virales de X)
  ‚úÖ Si tu app.js nuevo no usa estos IDs, NO afecta en nada.
-->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Panel PRO para extraer noticias (RSS/Atom/JSON), resolver link original, im√°genes y generar plantilla lista para X." />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="application-name" content="Tweet News Panel" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Icons (si existen, perfecto; si no, no rompe) -->
  <link rel="icon" href="./assets/icons/favicon-32.png" sizes="32x32" />
  <link rel="icon" href="./assets/icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon-180.png" sizes="180x180" />

  <!-- Perf: preconnect a endpoints t√≠picos -->
  <link rel="preconnect" href="https://news.google.com" crossorigin />
  <link rel="preconnect" href="https://api.allorigins.win" crossorigin />
  <link rel="preconnect" href="https://r.jina.ai" crossorigin />
  <link rel="preconnect" href="https://translate.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://www.google.com" crossorigin />

  <!-- Preload CSS -->
  <link rel="preload" href="./styles.css" as="style" />
  <link rel="stylesheet" href="./styles.css" />

  <title>News ‚Üí Tweet Template Panel</title>

  <!-- A11y + mobile tap highlight (no depende del CSS principal) -->
  <style>
    :focus-visible{ outline: 2px solid rgba(29,155,240,55); outline-offset: 2px; border-radius: 12px; }
    *{ -webkit-tap-highlight-color: rgba(29,155,240,18); }
    .skipLink{
      position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;
    }
    .skipLink:focus{
      left:12px; top:12px; width:auto; height:auto; padding:10px 12px;
      background:#0b1220; color:#fff; border:1px solid rgba(255,255,255,12);
      border-radius:12px; z-index:99999;
    }
    noscript{
      display:block; margin:12px; padding:12px;
      background:rgba(255,107,107,12); border:1px solid rgba(255,107,107,35);
      border-radius:12px; color:#ffd1d1;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ REALTIME TICKERS (solo HTML/CSS) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
       - app.js puede escribir dentro de #newsTickerTrack y #trendTickerTrack
       - popticker opcional (#popTicker, #trendPopTicker)
       - No requiere cambios en styles.css (esto lo complementa)
    */
    :root{
      --tickerH: 44px;
    }
    .tickerBar{
      position: sticky;
      top: var(--topbarH);
      z-index: 25;
      height: var(--tickerH);
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,92);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 8px 12px;
      overflow:hidden;
    }
    .tickerRow{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
      flex: 1 1 0;
    }
    .tickerLabel{
      flex: 0 0 auto;
      font-size: 11px;
      font-weight: 900;
      letter-spacing: .2px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,12);
      background: rgba(255,255,255,04);
      color: rgba(231,233,234,88);
      white-space: nowrap;
      user-select: none;
    }
    .tickerLabel.news{
      border-color: rgba(245,158,11,28);
      background: rgba(245,158,11,10);
    }
    .tickerLabel.trends{
      border-color: rgba(29,155,240,28);
      background: rgba(29,155,240,10);
    }

    .tickerViewport{
      position: relative;
      flex: 1 1 auto;
      min-width: 0;
      overflow:hidden;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,10);
      background: rgba(255,255,255,03);
      height: 30px;
      display:flex;
      align-items:center;
    }
    .tickerTrack{
      display:inline-block;
      white-space: nowrap;
      padding-left: 12px;
      padding-right: 12px;
      color: rgba(231,233,234,88);
      font-size: 12px;
      font-weight: 700;
      will-change: transform;
      animation: tnp_marquee 24s linear infinite;
    }
    .tickerTrack[data-speed="slow"]{ animation-duration: 34s; }
    .tickerTrack[data-speed="fast"]{ animation-duration: 18s; }

    /* Si el track es corto, app.js puede poner data-nomove="1" */
    .tickerTrack[data-nomove="1"]{ animation: none !important; }

    @keyframes tnp_marquee{
      0%{ transform: translateX(0); }
      100%{ transform: translateX(-55%); }
    }

    /* Pop ticker (toast flotante) */
    .popTicker{
      position: fixed;
      left: 12px;
      right: 12px;
      bottom: 12px;
      z-index: 80;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,12);
      background: rgba(0,0,0,86);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 10px 12px;
      color: rgba(231,233,234,92);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
      box-shadow: 0 10px 35px rgba(0,0,0,45);
      display:flex;
      gap: 10px;
      align-items:flex-start;
    }
    .popTicker.hidden{ display:none !important; }
    .popDot{
      width: 10px; height: 10px;
      border-radius: 999px;
      background: #1D9BF0;
      box-shadow: 0 0 0 4px rgba(29,155,240,10);
      margin-top: 4px;
      flex: 0 0 auto;
    }
    .popBody{ min-width:0; }
    .popTitle{
      font-weight: 900;
      letter-spacing: .12px;
      margin: 0 0 2px 0;
      font-size: 12px;
      color: rgba(231,233,234,88);
    }
    .popText{
      margin:0;
      font-size: 13px;
      font-weight: 750;
      color: rgba(231,233,234,94);
      word-break: break-word;
    }

    /* Ajuste del layout para no quedar ‚Äúdebajo‚Äù del ticker */
    @media (min-width: 981px){
      .layout{ height: calc(100vh - var(--topbarH) - var(--tickerH)); }
    }
    @media (max-width: 980px){
      .tickerBar{ position: static; height: auto; padding: 10px 12px; }
      .tickerViewport{ height: 32px; }
      .layout{ height: auto; }
    }
    @media (prefers-reduced-motion: reduce){
      .tickerTrack{ animation: none !important; }
    }
  </style>
</head>

<body>
  <a class="skipLink" href="#main">Saltar al contenido</a>

  <noscript>
    Este panel necesita JavaScript para funcionar.
  </noscript>

  <header class="topbar" role="banner">
    <div class="topLeft">
      <div class="brand" aria-label="Panel">
        <div class="dot" aria-hidden="true"></div>
        <div>
          <div class="brandTitle">News ‚Üí Tweet Template Panel</div>
          <div class="brandSub">RSS/Atom/JSON ¬∑ Link original ¬∑ Im√°genes ¬∑ X-count ¬∑ PWA</div>
        </div>
      </div>

      <div class="topControls" aria-label="Controles superiores">
        <label class="mini">
          Ventana
          <select id="timeFilter" class="select" aria-label="Ventana de tiempo">
            <option value="1">1h</option>
            <option value="3">3h</option>
            <option value="6">6h</option>
            <option value="12">12h</option>
            <option value="24" selected>24h</option>
            <option value="72">72h</option>
          </select>
        </label>

        <label class="mini">
          Mostrar
          <select id="showLimit" class="select" aria-label="L√≠mite visual de noticias">
            <option value="10" selected>10</option>
            <option value="20">20</option>
            <option value="30">30</option>
            <option value="50">50</option>
          </select>
        </label>

        <label class="mini" title="Tope total en memoria (fetch cap). Evita colapsos si tienes muchos feeds.">
          Tope
          <input id="fetchCap" class="input" inputmode="numeric" type="number" min="80" max="2000" step="20" value="240" aria-label="Tope total de items" />
        </label>

        <input id="searchBox" class="input" placeholder="Buscar‚Ä¶" aria-label="Buscar noticias" autocomplete="off" />

        <button id="btnRefresh" class="btn primary" type="button" aria-label="Refrescar">‚ü≥ Refrescar</button>
        <button id="btnFeeds" class="btn" type="button" aria-label="Gestionar feeds" aria-controls="modal" aria-haspopup="dialog">‚öô Feeds</button>
      </div>
    </div>

    <div class="topRight" aria-label="Estado">
      <div id="status" class="status" role="status" aria-live="polite">Listo</div>
    </div>
  </header>

  <!-- REALTIME TICKERS (noticias + tendencias) -->
  <div id="tickerBar" class="tickerBar" role="region" aria-label="Tickers en tiempo real">
    <div class="tickerRow" aria-label="Ticker de noticias relevantes">
      <div class="tickerLabel news">üì∞ RELEVANTE</div>
      <div class="tickerViewport">
        <!-- app.js nuevo: rellena esto en tiempo real -->
        <div id="newsTickerTrack" class="tickerTrack" data-speed="slow">Cargando titulares‚Ä¶</div>

        <!-- Aliases por compat (por si tu app.js usa otros IDs) -->
        <div id="newsTicker" class="tickerTrack hidden" aria-hidden="true"></div>
        <div id="tickerNews" class="tickerTrack hidden" aria-hidden="true"></div>
        <div id="rtNewsTicker" class="tickerTrack hidden" aria-hidden="true"></div>
      </div>
    </div>

    <div class="tickerRow" aria-label="Ticker de tendencias virales">
      <div class="tickerLabel trends">üî• TENDENCIAS</div>
      <div class="tickerViewport">
        <!-- app.js nuevo: rellena esto en tiempo real -->
        <div id="trendTickerTrack" class="tickerTrack" data-speed="fast">Cargando tendencias‚Ä¶</div>

        <!-- Aliases por compat -->
        <div id="trendTicker" class="tickerTrack hidden" aria-hidden="true"></div>
        <div id="tickerTrends" class="tickerTrack hidden" aria-hidden="true"></div>
        <div id="rtTrendsTicker" class="tickerTrack hidden" aria-hidden="true"></div>
      </div>
    </div>
  </div>

  <!-- Pop tickers (toast flotante). app.js puede mostrar/ocultar quitando/poniendo .hidden -->
  <div id="popTicker" class="popTicker hidden" role="status" aria-live="polite" aria-label="Popticker de √∫ltima hora">
    <div class="popDot" aria-hidden="true"></div>
    <div class="popBody">
      <div class="popTitle">√öLTIMA HORA</div>
      <p id="popTickerText" class="popText">‚Äî</p>
    </div>
  </div>

  <div id="trendPopTicker" class="popTicker hidden" role="status" aria-live="polite" aria-label="Popticker de tendencia">
    <div class="popDot" aria-hidden="true"></div>
    <div class="popBody">
      <div class="popTitle">TENDENCIA</div>
      <p id="trendPopTickerText" class="popText">‚Äî</p>
    </div>
  </div>

  <main id="main" class="layout" role="main">
    <!-- LEFT: COMPOSER -->
    <section class="panel left" aria-label="Plantilla">
      <div class="panelHead">
        <h2>Plantilla</h2>
        <div class="row wrap" aria-label="Acciones de plantilla">
          <button id="btnTrim" class="btn" type="button" title="Intenta ajustar a 280">‚úÇ Ajustar</button>
          <button id="btnGenTags" class="btn" type="button" title="Genera hashtags desde el titular">üè∑ Hashtags</button>
          <button id="btnCopyUrl" class="btn" type="button" title="Copia SOURCE_URL">üîó Copiar URL</button>
          <button id="btnX" class="btn" type="button" title="Abre intent de X con el texto">ùïè Abrir X</button>
          <button id="btnCopy" class="btn primary" type="button" title="Copia el tweet final">üìã Copiar</button>
          <button id="btnResetTemplate" class="btn" type="button" title="Restaura la plantilla por defecto">‚Ü© Reset</button>
        </div>
      </div>

      <div class="panelBody">
        <div class="grid2" role="group" aria-label="Opciones de plantilla">
          <label class="mini">
            LIVE_URL
            <input id="liveUrl" class="input" placeholder="https://twitch.com/globaleyetv" autocomplete="off" />
          </label>

          <label class="mini">
            HASHTAGS
            <input id="hashtags" class="input" placeholder="#ENVIVO #Breaking #Noticias" autocomplete="off" />
          </label>

          <label class="mini checkbox" title="A√±ade/quita el bloque üî¥#ENVIVO del preview">
            <input id="optIncludeLive" type="checkbox" checked />
            Incluir LIVE_URL
          </label>

          <label class="mini checkbox" title="A√±ade/quita el bloque Fuente del preview">
            <input id="optIncludeSource" type="checkbox" checked />
            Incluir Fuente
          </label>
        </div>

        <div class="hr" role="separator" aria-hidden="true"></div>

        <label class="mini">
          HEADLINE
          <input id="headline" class="input" placeholder="Titular‚Ä¶" autocomplete="off" />
        </label>

        <label class="mini" style="margin-top:10px;">
          SOURCE_URL
          <input id="sourceUrl" class="input" placeholder="https://‚Ä¶" autocomplete="off" />
        </label>

        <div class="hr" role="separator" aria-hidden="true"></div>

        <label class="mini">
          TEMPLATE
          <textarea id="template" class="textarea" rows="8" spellcheck="false" aria-label="Plantilla del tweet"></textarea>
        </label>

        <div class="hr" role="separator" aria-hidden="true"></div>

        <div class="row between" aria-label="Resumen">
          <div class="mini">X-count: <b id="charCount">0</b>/280</div>
          <div class="mini muted">Tip: ‚ÄúUsar‚Äù carga titular+link y marca como usado.</div>
        </div>

        <pre id="preview" class="preview" aria-label="Vista previa del tweet" tabindex="0"></pre>
        <div id="warn" class="warn hidden" role="alert" aria-live="polite"></div>
      </div>
    </section>

    <!-- RIGHT: NEWS -->
    <section class="panel right" aria-label="Noticias">
      <div class="panelHead">
        <h2>Noticias</h2>

        <div class="row wrap" aria-label="Filtros principales">
          <label class="mini" title="Tiempo m√≠nimo para marcar como LISTO (evita publicaciones demasiado tempranas)">
            Delay
            <input id="delayMin" class="input" type="number" min="0" max="120" step="1" value="10" style="width:90px;" />
          </label>

          <label class="mini checkbox" title="Muestra solo items que ya cumplieron el delay">
            <input id="optOnlyReady" type="checkbox" />
            Solo LISTO
          </label>

          <label class="mini checkbox" title="Traduce t√≠tulos a ES (solo visibles) si hace falta">
            <input id="optOnlySpanish" type="checkbox" checked />
            ES (auto)
          </label>

          <label class="mini">
            Orden
            <select id="sortBy" class="select" aria-label="Orden de lista">
              <option value="recent" selected>Recientes</option>
              <option value="impact">Impacto</option>
              <option value="source">Fuente</option>
            </select>
          </label>

          <label class="mini">
            Cat
            <select id="catFilter" class="select" aria-label="Filtro por categor√≠a">
              <option value="all" selected>All</option>
              <option value="spain">Espa√±a</option>
              <option value="world">Mundo</option>
              <option value="war">Guerra</option>
              <option value="politics">Pol√≠tica</option>
              <option value="economy">Econom√≠a</option>
              <option value="tech">Tech</option>
              <option value="crime">Sucesos</option>
              <option value="health">Salud</option>
              <option value="sports">Deportes</option>
              <option value="ent">Entretenimiento</option>
            </select>
          </label>
        </div>

        <div class="row wrap" aria-label="Opciones avanzadas">
          <label class="mini checkbox" title="Refresca autom√°ticamente (rota feeds por lotes)">
            <input id="optAutoRefresh" type="checkbox" checked />
            Auto-refresh
          </label>

          <label class="mini" title="Intervalo de auto-refresh">
            cada
            <input id="refreshSec" class="input" type="number" min="15" max="600" step="5" value="30" style="width:90px;" />
            s
          </label>

          <label class="mini checkbox" title="Intenta resolver enlaces tipo Google News / redirects al enlace real">
            <input id="optResolveLinks" type="checkbox" checked />
            Resolver links
          </label>

          <label class="mini checkbox" title="Muestra el titular original si ha sido traducido">
            <input id="optShowOriginal" type="checkbox" checked />
            Ver original
          </label>

          <label class="mini checkbox" title="Oculta los marcados como usados">
            <input id="optHideUsed" type="checkbox" />
            Ocultar usados
          </label>

          <label class="mini" title="Cu√°ntos feeds se refrescan por ciclo (rendimiento). Manual/Force refresca todos.">
            Batch
            <input id="batchFeeds" class="input" type="number" min="4" max="50" step="1" value="12" style="width:90px;" />
          </label>
        </div>
      </div>

      <div class="newsTop" aria-label="Consejos">
        <div class="mini muted">
          Consejo: con muchos feeds, sube Batch a 16‚Äì20 o sube el intervalo; el sistema rota por lotes para no colapsar.
        </div>
      </div>

      <div id="newsList" class="newsList" aria-label="Lista de noticias" role="feed" aria-busy="false"></div>
    </section>
  </main>

  <!-- MODAL FEEDS -->
  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-label="Gestionar feeds" tabindex="-1">
      <div class="modalHead">
        <h3>Feeds</h3>
        <button id="btnCloseModal" class="btn" type="button" aria-label="Cerrar modal">Cerrar</button>
      </div>

      <div class="modalBody">
        <div class="grid2" role="group" aria-label="A√±adir feed">
          <label class="mini">
            Nombre
            <input id="newFeedName" class="input" placeholder="Mi feed" autocomplete="off" />
          </label>
          <label class="mini">
            URL RSS/Atom/JSON
            <input id="newFeedUrl" class="input" placeholder="https://." autocomplete="off" />
          </label>
        </div>

        <div class="row wrap" style="margin-top:10px;" aria-label="Acciones de feeds">
          <button id="btnAddFeed" class="btn primary" type="button">+ A√±adir</button>
          <button id="btnExportFeeds" class="btn" type="button">Exportar</button>
          <button id="btnImportFeeds" class="btn" type="button">Importar</button>
          <button id="btnRestoreDefaultFeeds" class="btn" type="button">Defaults</button>
        </div>

        <textarea
          id="feedsJson"
          class="textarea"
          rows="6"
          placeholder="Export/Import JSON aqu√≠‚Ä¶"
          style="margin-top:10px;"
          spellcheck="false"
          aria-label="JSON de feeds"
        ></textarea>

        <div class="hr" role="separator" aria-hidden="true"></div>
        <div id="feedList" class="feedList" aria-label="Feeds actuales"></div>
      </div>

      <div class="modalFoot">
        <div class="mini muted">Activa/desactiva feeds y guarda. Los cambios se aplican al cerrar.</div>
        <button id="btnSaveFeeds" class="btn primary" type="button">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Sync aria-hidden del modal seg√∫n .hidden (no interfiere con app.js) -->
  <script>
    (function(){
      try{
        var modal = document.getElementById("modal");
        if(!modal) return;

        function sync(){
          var hidden = modal.classList.contains("hidden");
          modal.setAttribute("aria-hidden", hidden ? "true" : "false");
        }
        sync();

        if ("MutationObserver" in window) {
          var mo = new MutationObserver(sync);
          mo.observe(modal, { attributes:true, attributeFilter:["class"] });
        }
      }catch(e){}
    })();
  </script>

  <script src="./app.js"></script>
</body>
</html>
