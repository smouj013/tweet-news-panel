<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#05060a" />
  <meta name="description" content="Panel PRO para extraer noticias (RSS/Atom/JSON), resolver link original, imÃ¡genes y generar plantilla lista para X." />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="application-name" content="Tweet News Panel" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Icons (si existen, perfecto; si no, no rompe) -->
  <link rel="icon" href="./assets/icons/favicon-32.png" sizes="32x32" />
  <link rel="icon" href="./assets/icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon-180.png" sizes="180x180" />

  <!-- Perf (opcionales) -->
  <link rel="preconnect" href="https://news.google.com" crossorigin />
  <link rel="preconnect" href="https://api.allorigins.win" crossorigin />
  <link rel="preconnect" href="https://r.jina.ai" crossorigin />
  <link rel="preconnect" href="https://translate.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://www.google.com" crossorigin />

  <link rel="preload" href="./styles.css" as="style" />
  <link rel="stylesheet" href="./styles.css" />

  <title>News â†’ Tweet Template Panel</title>
</head>

<body>
  <a class="skipLink" href="#main">Saltar al contenido</a>

  <noscript class="noscript">
    Este panel necesita JavaScript para funcionar.
  </noscript>

  <!-- IMPORTANTE:
    app.js busca ".topbar" para:
      - inyectar el ticker (tnpTickerBar)
      - calcular alturas (syncTopbarHeight)
  -->
  <header class="topbar" id="topbar" role="banner">
    <div class="topLeft">
      <div class="brand" aria-label="Panel">
        <span class="brandDot" aria-hidden="true"></span>
        <div class="brandText">
          <div class="brandTitle">News â†’ Tweet Template Panel</div>
          <div class="brandSub">RSS/Atom/JSON Â· Link original Â· ImÃ¡genes Â· X-ready Â· PWA</div>
        </div>
      </div>

      <div class="topControls" aria-label="Controles superiores">
        <label class="ctlWrap" title="Ventana temporal">
          <span class="ctlLabel">Ventana</span>
          <select id="timeFilter" class="ctl">
            <option value="1">1h</option>
            <option value="3">3h</option>
            <option value="6">6h</option>
            <option value="12">12h</option>
            <option value="24" selected>24h</option>
            <option value="72">72h</option>
          </select>
        </label>

        <label class="ctlWrap" title="CuÃ¡ntas noticias se muestran en lista">
          <span class="ctlLabel">Mostrar</span>
          <select id="showLimit" class="ctl">
            <option value="10" selected>10</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="30">30</option>
            <option value="50">50</option>
          </select>
        </label>

        <label class="ctlWrap" title="Tope de items a descargar por refresh">
          <span class="ctlLabel">Fetch</span>
          <select id="fetchCap" class="ctl">
            <option value="80">80</option>
            <option value="120">120</option>
            <option value="180">180</option>
            <option value="240" selected>240</option>
            <option value="500">500</option>
            <option value="1000">1000</option>
            <option value="2000">2000</option>
          </select>
        </label>

        <label class="searchWrap" title="Buscar en titulares">
          <span class="ctlLabel">Buscar</span>
          <input id="searchBox" class="ctl search" type="search" placeholder="Palabras claveâ€¦" autocomplete="off" />
        </label>

        <button id="btnRefresh" class="btn primary" type="button" title="Actualizar feeds">Actualizar</button>
        <button id="btnFeeds" class="btn ghost" type="button" title="Gestionar feeds">Feeds</button>
      </div>
    </div>

    <div class="topRight">
      <div id="status" class="status" role="status" aria-live="polite">Listo</div>
    </div>
  </header>

  <main id="main">
    <div class="layout">
      <!-- PANEL: Lista -->
      <section class="panel" aria-label="Lista de noticias">
        <div class="panelHead">
          <div class="panelTitle">
            <h2>Noticias</h2>
            <div class="panelHint">Selecciona una noticia para rellenar la plantilla.</div>
          </div>

          <div class="panelTools">
            <label class="ctlLine" title="Retraso mÃ­nimo para considerar â€˜recienteâ€™ (min)">
              <span class="ctlLabel">Delay</span>
              <input id="delayMin" class="ctl miniNum" type="number" min="0" max="120" step="1" value="10" />
              <span class="ctlSuffix">min</span>
            </label>

            <label class="check">
              <input id="optOnlyReady" type="checkbox" />
              <span>Solo LISTO</span>
            </label>

            <label class="check">
              <input id="optOnlySpanish" type="checkbox" checked />
              <span>ES</span>
            </label>

            <label class="ctlLine" title="Orden">
              <span class="ctlLabel">Orden</span>
              <select id="sortBy" class="ctl">
                <option value="recent" selected>Reciente</option>
                <option value="impact">Impacto</option>
                <option value="source">Fuente</option>
              </select>
            </label>

            <label class="check">
              <input id="optHideUsed" type="checkbox" />
              <span>Ocultar usadas</span>
            </label>

            <label class="check">
              <input id="optResolveLinks" type="checkbox" checked />
              <span>Resolver links</span>
            </label>

            <label class="check">
              <input id="optShowOriginal" type="checkbox" />
              <span>Mostrar original</span>
            </label>

            <label class="ctlLine" title="CategorÃ­a">
              <span class="ctlLabel">Cat</span>
              <select id="catFilter" class="ctl">
                <option value="all" selected>Todas</option>
                <option value="spain">EspaÃ±a</option>
                <option value="world">Mundo</option>
                <option value="politics">PolÃ­tica</option>
                <option value="economy">EconomÃ­a</option>
                <option value="tech">Tech</option>
                <option value="sports">Deportes</option>
                <option value="culture">Cultura</option>
              </select>
            </label>

            <label class="ctlLine" title="Refresco automÃ¡tico">
              <input id="optAutoRefresh" type="checkbox" checked />
              <span class="ctlInline">Auto</span>
              <input id="refreshSec" class="ctl miniNum" type="number" min="15" max="600" step="5" value="60" />
              <span class="ctlSuffix">s</span>
            </label>

            <label class="ctlLine" title="Feeds por lote en refresh (performance)">
              <span class="ctlLabel">Batch</span>
              <input id="batchFeeds" class="ctl miniNum" type="number" min="4" max="50" step="1" value="12" />
            </label>
          </div>
        </div>

        <div class="panelBody listBody">
          <div id="newsList" class="newsList" aria-live="polite"></div>
        </div>
      </section>

      <!-- PANEL: Composer -->
      <section class="panel" aria-label="Composer de plantilla">
        <div class="panelHead">
          <div class="panelTitle">
            <h2>Plantilla</h2>
            <div class="panelHint">Copia/pega directo a X con link real y limpio.</div>
          </div>

          <div class="panelTools rightTools">
            <button id="btnResetTemplate" class="btn ghost" type="button" title="Restaurar plantilla">Reset</button>
            <button id="btnTrim" class="btn ghost" type="button" title="Ajustar titular a longitud segura">Trim</button>
            <button id="btnGenTags" class="btn ghost" type="button" title="Sugerir hashtags">#Tags</button>
          </div>
        </div>

        <div class="panelBody composerBody">
          <div id="warn" class="warn hidden" role="status" aria-live="polite"></div>

          <div class="formGrid">
            <label class="field">
              <span class="fieldLabel">ðŸ”´ En vivo (tu directo)</span>
              <input id="liveUrl" class="ctl" type="url" placeholder="https://twitch.com/globaleyetv" />
            </label>

            <div class="row2">
              <label class="field">
                <span class="fieldLabel">Titular</span>
                <input id="headline" class="ctl" type="text" placeholder="ðŸš¨ ÃšLTIMA HORA: ..." />
              </label>

              <label class="field">
                <span class="fieldLabel">Fuente (URL real)</span>
                <input id="sourceUrl" class="ctl" type="url" placeholder="https://reuters.com/..." />
              </label>
            </div>

            <label class="field">
              <span class="fieldLabel">Hashtags</span>
              <input id="hashtags" class="ctl" type="text" placeholder="#ÃšltimaHora #EspaÃ±a ..." />
            </label>

            <div class="checksRow">
              <label class="check">
                <input id="optIncludeLive" type="checkbox" checked />
                <span>Incluir ENVIVO</span>
              </label>
              <label class="check">
                <input id="optIncludeSource" type="checkbox" checked />
                <span>Incluir Fuente</span>
              </label>
            </div>

            <label class="field">
              <span class="fieldLabel">Plantilla</span>
              <textarea id="template" class="ctl textarea" rows="8" spellcheck="false"></textarea>
              <div class="underRow">
                <div class="mutedSmall">Caracteres: <strong id="charCount">0</strong></div>
                <div class="underBtns">
                  <button id="btnCopyUrl" class="btn ghost" type="button" title="Copiar URL limpia">Copiar URL</button>
                  <button id="btnCopy" class="btn primary" type="button" title="Copiar texto listo">Copiar</button>
                  <button id="btnX" class="btn x" type="button" title="Abrir X para postear">Abrir X</button>
                </div>
              </div>
            </label>

            <div class="previewBox">
              <div class="previewHead">
                <div class="previewTitle">Preview</div>
                <div class="mutedSmall">Tal cual lo copiarÃ¡s.</div>
              </div>
              <pre id="preview" class="preview"></pre>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- MODAL FEEDS -->
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modalBackdrop" data-close="1"></div>

    <div class="modalCard" role="document">
      <div class="modalHead">
        <div>
          <div class="modalTitle" id="modalTitle">Feeds</div>
          <div class="modalSub">Activa/desactiva, aÃ±ade nuevos, exporta/importa JSON.</div>
        </div>
        <button id="btnCloseModal" class="btn ghost" type="button">Cerrar</button>
      </div>

      <div class="modalBody">
        <div class="modalGrid">
          <section class="modalSection">
            <div class="sectionTitle">AÃ±adir feed</div>
            <label class="field">
              <span class="fieldLabel">Nombre</span>
              <input id="newFeedName" class="ctl" type="text" placeholder="Ej: Reuters World (RSS)" />
            </label>
            <label class="field">
              <span class="fieldLabel">URL</span>
              <input id="newFeedUrl" class="ctl" type="url" placeholder="https://..." />
            </label>
            <button id="btnAddFeed" class="btn primary" type="button">AÃ±adir</button>

            <div class="hr"></div>
            <div class="sectionTitle">Lista</div>
            <div id="feedList" class="feedList"></div>
          </section>

          <section class="modalSection">
            <div class="sectionTitle">Importar / Exportar</div>
            <textarea id="feedsJson" class="ctl textarea" rows="14" spellcheck="false"
              placeholder='Pega aquÃ­ tu JSON de feedsâ€¦'></textarea>

            <div class="rowWrap">
              <button id="btnExportFeeds" class="btn ghost" type="button">Exportar</button>
              <button id="btnImportFeeds" class="btn ghost" type="button">Importar</button>
              <button id="btnRestoreDefaultFeeds" class="btn ghost" type="button">Restaurar</button>
              <button id="btnSaveFeeds" class="btn primary" type="button">Guardar</button>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>

  <script src="./app.js" defer></script>

  <script>
    // SW (seguro, no rompe si ya lo haces en app.js)
    (function(){
      try{
        if ("serviceWorker" in navigator) {
          navigator.serviceWorker.register("./sw.js").catch(()=>{});
        }
      }catch(_){}
    })();
  </script>
</body>
</html>
