<!-- index.html ‚Äî News ‚Üí Tweet Template Panel (tnp-v4.0.1+) ‚Äî X Clean Dark ‚Äî PRO + REALTIME TICKERS
  ‚úÖ Mantiene 100% compat con tus IDs/clases actuales (NO rompe nada)
  ‚úÖ FIX: alphas en rgba() (evita ‚Äútodo blanco‚Äù)
-->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Panel PRO para extraer noticias (RSS/Atom/JSON), resolver link original, im√°genes y generar plantilla lista para X." />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="application-name" content="Tweet News Panel" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Icons (si existen, perfecto; si no, no rompe) -->
  <link rel="icon" href="./assets/icons/favicon-32.png" sizes="32x32" />
  <link rel="icon" href="./assets/icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="./assets/icons/apple-touch-icon-180.png" sizes="180x180" />

  <!-- Perf: preconnect a endpoints t√≠picos -->
  <link rel="preconnect" href="https://news.google.com" crossorigin />
  <link rel="preconnect" href="https://api.allorigins.win" crossorigin />
  <link rel="preconnect" href="https://r.jina.ai" crossorigin />
  <link rel="preconnect" href="https://translate.googleapis.com" crossorigin />
  <link rel="preconnect" href="https://www.google.com" crossorigin />

  <!-- Preload CSS -->
  <link rel="preload" href="./styles.css" as="style" />
  <link rel="stylesheet" href="./styles.css" />

  <title>News ‚Üí Tweet Template Panel</title>

  <!-- FIX CR√çTICO: rgba alpha debe ser 0..1 (0.12, 0.55, etc), si no -> todo opaco/blanco -->
  <style>
    html, body { background:#05060a; color:#e7e9ea; }

    :focus-visible{
      outline: 2px solid rgba(29,155,240,0.55);
      outline-offset: 2px;
      border-radius: 12px;
    }
    *{ -webkit-tap-highlight-color: rgba(29,155,240,0.18); }

    .skipLink{
      position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;
    }
    .skipLink:focus{
      left:12px; top:12px; width:auto; height:auto; padding:10px 12px;
      background:#0b1220; color:#fff; border:1px solid rgba(255,255,255,0.12);
      border-radius:12px; z-index:99999;
    }
    noscript{
      display:block; margin:12px; padding:12px;
      background:rgba(255,107,107,0.12);
      border:1px solid rgba(255,107,107,0.35);
      border-radius:14px;
      color:#ffe6ec;
    }

    /* Si tu styles.css a√∫n tiene alphas ‚Äú12/03/55‚Äù, esto ayuda a que NO se blanquee. */
    .modal{ background: rgba(0,0,0,0.72) !important; }
  </style>
</head>

<body>
  <a class="skipLink" href="#main">Saltar a contenido</a>
  <noscript>Necesitas JavaScript para usar este panel.</noscript>

  <!-- TOPBAR -->
  <header class="topbar" id="topbar">
    <div class="brand">
      <span class="dot"></span>
      <div class="brandText">
        <div class="brandTitle">News ‚Üí Tweet Template</div>
        <div class="brandSub muted">RSS/Atom/JSON ‚Ä¢ links reales ‚Ä¢ im√°genes ‚Ä¢ plantilla X</div>
      </div>
    </div>

    <div class="topControls" aria-label="Controles superiores">
      <label class="mini">
        Tiempo
        <select id="timeFilter" class="select" aria-label="Filtro de tiempo">
          <option value="15" selected>15m</option>
          <option value="30">30m</option>
          <option value="60">1h</option>
          <option value="180">3h</option>
          <option value="360">6h</option>
          <option value="720">12h</option>
          <option value="1440">24h</option>
        </select>
      </label>

      <label class="mini" title="Cu√°ntas noticias mostrar en lista">
        Mostrar
        <input id="showLimit" class="input" type="number" min="10" max="50" step="1" value="10" style="width:90px;" />
      </label>

      <label class="mini" title="Tope total en memoria (rendimiento)">
        Cap
        <input id="fetchCap" class="input" type="number" min="80" max="2000" step="20" value="240" style="width:100px;" />
      </label>

      <label class="mini" style="min-width:240px; flex:1;">
        Buscar
        <input id="searchBox" class="input" placeholder="Buscar titular/fuente‚Ä¶" autocomplete="off" />
      </label>

      <div class="row">
        <button id="btnRefresh" class="btn primary" type="button" title="Refrescar (rota feeds por lotes)">Refresh</button>
        <button id="btnForceRefresh" class="btn" type="button" title="Force refresh (intenta todo, m√°s caro)">Force</button>
        <button id="btnFeeds" class="btn" type="button" title="Gestionar feeds">Feeds</button>
      </div>
    </div>

    <div id="status" class="status" aria-live="polite"></div>
  </header>

  <!-- TICKERS (si app.js los usa) -->
  <div id="newsTickerBar" class="tickerBar hidden" aria-hidden="true">
    <div class="tickerLabel news">NEWS</div>
    <div class="tickerViewport" aria-hidden="true">
      <div id="newsTickerTrack" class="tickerTrack"></div>
    </div>
  </div>

  <div id="trendTickerBar" class="tickerBar hidden" aria-hidden="true">
    <div class="tickerLabel trend">TREND</div>
    <div class="tickerViewport" aria-hidden="true">
      <div id="trendTickerTrack" class="tickerTrack"></div>
    </div>
  </div>

  <div id="popTicker" class="popTicker hidden" aria-hidden="true">
    <div class="popDot"></div>
    <div id="popTickerText" class="popText"></div>
  </div>

  <div id="trendPopTicker" class="popTicker trend hidden" aria-hidden="true">
    <div class="popDot"></div>
    <div id="trendPopTickerText" class="popText"></div>
  </div>

  <!-- MAIN -->
  <main id="main" class="main" tabindex="-1">
    <!-- LEFT PANEL -->
    <section class="panel left" aria-label="Plantilla y preview">
      <div class="panelHead">
        <h2>Tweet</h2>
        <div class="row">
          <span class="mini muted">Chars</span>
          <span id="charCount" class="badge">0</span>
        </div>
      </div>

      <div class="panelBody">
        <div class="grid2" role="group" aria-label="Inputs base">
          <label class="mini">
            En vivo (URL)
            <input id="liveUrl" class="input" placeholder="https://twitch.com/globaleyetv" autocomplete="off" />
          </label>
          <label class="mini">
            Hashtags
            <input id="hashtags" class="input" placeholder="#ENVIVO #√öLTIMAHORA" autocomplete="off" />
          </label>
        </div>

        <div class="grid2" role="group" aria-label="Titular y fuente">
          <label class="mini">
            Titular
            <input id="headline" class="input" placeholder="üö® √öLTIMA HORA: ‚Ä¶" autocomplete="off" />
          </label>
          <label class="mini">
            Fuente (URL)
            <input id="sourceUrl" class="input" placeholder="https://‚Ä¶" autocomplete="off" />
          </label>
        </div>

        <div class="row wrap" aria-label="Opciones de plantilla">
          <label class="mini checkbox">
            <input id="optIncludeLive" type="checkbox" checked />
            Incluir üî¥#ENVIVO
          </label>

          <label class="mini checkbox">
            <input id="optIncludeSource" type="checkbox" checked />
            Incluir Fuente
          </label>
        </div>

        <label class="mini" style="display:block;">
          Plantilla
          <textarea id="template" class="textarea" rows="7" spellcheck="false"></textarea>
        </label>

        <div id="warn" class="warn hidden" role="alert"></div>

        <label class="mini" style="display:block;">
          Preview
          <pre id="preview" class="preview"></pre>
        </label>

        <div class="row wrap" aria-label="Acciones tweet">
          <button id="btnTrim" class="btn" type="button">Ajustar</button>
          <button id="btnGenTags" class="btn" type="button">Tags</button>
          <button id="btnCopyUrl" class="btn" type="button">Copiar link</button>
          <button id="btnX" class="btn primary" type="button">Abrir X</button>
          <button id="btnCopy" class="btn" type="button">Copiar</button>
          <button id="btnResetTemplate" class="btn danger" type="button">Reset</button>
        </div>
      </div>
    </section>

    <!-- RIGHT PANEL -->
    <section class="panel right" aria-label="Noticias">
      <div class="panelHead">
        <h2>Noticias</h2>

        <div class="row wrap" aria-label="Filtros">
          <label class="mini" title="Ignora noticias demasiado recientes (minutos) para que d√© tiempo a resolver/OG/traducci√≥n">
            Delay
            <input id="delayMin" class="input" type="number" min="0" max="120" step="1" value="10" style="width:90px;" />
            min
          </label>

          <label class="mini checkbox" title="Solo muestra items marcados como LISTO">
            <input id="optOnlyReady" type="checkbox" />
            Solo LISTO
          </label>

          <label class="mini checkbox" title="Prioriza espa√±ol (modo por defecto)">
            <input id="optOnlySpanish" type="checkbox" checked />
            ES
          </label>

          <label class="mini">
            Orden
            <select id="sortBy" class="select" aria-label="Orden de lista">
              <option value="recent" selected>Recientes</option>
              <option value="impact">Impacto</option>
              <option value="source">Fuente</option>
            </select>
          </label>

          <label class="mini">
            Cat
            <select id="catFilter" class="select" aria-label="Filtro por categor√≠a">
              <option value="all" selected>All</option>
              <option value="spain">Espa√±a</option>
              <option value="world">Mundo</option>
              <option value="war">Guerra</option>
              <option value="politics">Pol√≠tica</option>
              <option value="economy">Econom√≠a</option>
              <option value="tech">Tech</option>
              <option value="crime">Sucesos</option>
              <option value="health">Salud</option>
              <option value="sports">Deportes</option>
              <option value="ent">Entretenimiento</option>
            </select>
          </label>
        </div>

        <div class="row wrap" aria-label="Opciones avanzadas">
          <label class="mini checkbox" title="Refresca autom√°ticamente (rota feeds por lotes)">
            <input id="optAutoRefresh" type="checkbox" checked />
            Auto-refresh
          </label>

          <label class="mini" title="Intervalo de auto-refresh">
            cada
            <input id="refreshSec" class="input" type="number" min="15" max="600" step="5" value="30" style="width:90px;" />
            s
          </label>

          <label class="mini checkbox" title="Intenta resolver enlaces tipo Google News / redirects al enlace real">
            <input id="optResolveLinks" type="checkbox" checked />
            Resolver links
          </label>

          <label class="mini checkbox" title="Muestra el titular original si ha sido traducido">
            <input id="optShowOriginal" type="checkbox" checked />
            Ver original
          </label>

          <label class="mini checkbox" title="Oculta los marcados como usados">
            <input id="optHideUsed" type="checkbox" />
            Ocultar usados
          </label>

          <label class="mini" title="Cu√°ntos feeds se refrescan por ciclo (rendimiento). Manual/Force refresca todos.">
            Batch
            <input id="batchFeeds" class="input" type="number" min="4" max="50" step="1" value="12" style="width:90px;" />
          </label>
        </div>
      </div>

      <div class="newsTop" aria-label="Consejos">
        <div class="mini muted">
          Consejo: con muchos feeds, sube Batch a 16‚Äì20 o sube el intervalo; el sistema rota por lotes para no colapsar.
        </div>
      </div>

      <div id="newsList" class="newsList" aria-label="Lista de noticias" role="feed" aria-busy="false"></div>
    </section>
  </main>

  <!-- MODAL FEEDS -->
  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-label="Gestionar feeds" tabindex="-1">
      <div class="modalHead">
        <h3>Feeds</h3>
        <button id="btnCloseModal" class="btn" type="button" aria-label="Cerrar modal">Cerrar</button>
      </div>

      <div class="modalBody">
        <div class="grid2" role="group" aria-label="A√±adir feed">
          <label class="mini">
            Nombre
            <input id="newFeedName" class="input" placeholder="Mi feed" autocomplete="off" />
          </label>
          <label class="mini">
            URL RSS/Atom/JSON
            <input id="newFeedUrl" class="input" placeholder="https://." autocomplete="off" />
          </label>
        </div>

        <div class="row wrap" style="margin-top:10px;">
          <button id="btnAddFeed" class="btn primary" type="button">A√±adir</button>
          <button id="btnExportFeeds" class="btn" type="button">Exportar</button>
          <button id="btnImportFeeds" class="btn" type="button">Importar</button>
          <button id="btnRestoreDefaultFeeds" class="btn danger" type="button">Restaurar</button>
          <button id="btnSaveFeeds" class="btn" type="button">Guardar</button>
        </div>

        <div id="feedList" class="feedList" role="list" aria-label="Lista de feeds"></div>

        <label class="mini" style="display:block; margin-top:10px;">
          JSON (opcional)
          <textarea id="feedsJson" class="textarea" rows="7" spellcheck="false"></textarea>
        </label>
      </div>
    </div>
  </div>

  <script defer src="./app.js"></script>
  <script>
    // SW (best-effort, no rompe si falla)
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(() => {});
      });
    }
  </script>
</body>
</html>
